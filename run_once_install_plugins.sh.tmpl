#! /bin/sh

COMPLETE=$HOME/.local/share/chezmoi/.first-time-update-completed
# install packages
{{ if eq .chezmoi.os "darwin" }} # mac
{{ else if eq .chezmoi.osRelease.id "debian" }} 
# raspberry pi or similar
if [ ! -f $COMPLETE ]; then
    echo "New machine! Performing first time package installation!"
    sudo apt update && sudo apt upgrade -y
    sudo apt install zsh fzf ranger bpytop neovim build-essential direnv

    # pyenv
    curl -fsSL https://pyenv.run | bash
    
    # lazygit
    curl -sL https://github.com/jesseduffield/lazygit/releases/download/v0.49.0/lazygit_0.49.0_Linux_arm64.tar.gz | tar xz -C "$HOME/bin" lazygit
    #done
    touch $COMPLETE
fi
{{ else }} # x86 linux assuming arch based
if [! -f $COMPLETE ] ;then
    echo "New machine! Performing first time package installation!"
fi
{{ end }}

# install oh-my-zsh
if [ ! -d "$HOME/.oh-my-zsh" ]; then
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
    ZSH_CUSTOM=$HOME/.oh-my-zsh/custom

    # install spaceship
    git clone https://github.com/spaceship-prompt/spaceship-prompt.git "$ZSH_CUSTOM/themes/spaceship-prompt" --depth=1
    ln -s "$ZSH_CUSTOM/themes/spaceship-prompt/spaceship.zsh-theme" "$ZSH_CUSTOM/themes/spaceship.zsh-theme"

    # install zsh plugins
    git clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $ZSH_CUSTOM/plugins/zsh-syntax-highlighting
    git clone https://github.com/lukechilds/zsh-nvm $ZSH_CUSTOM/plugins/zsh-nvm
    git clone https://github.com/jeffreytse/zsh-vi-mode $ZSH_CUSTOM/plugins/zsh-vi-mode
    git clone https://github.com/joshskidmore/zsh-fzf-history-search $ZSH_CUSTOM/plugins/zsh-fzf-history-search

fi

# nvim Plug

PLUG_INSTALLATION="${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim
sh -c '[ -e $PLUG_INSTALLATION ] || curl -fLo $PLUG_INSTALLATION --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
